if (typeof twilio == "undefined") { var twilio = {}; } twilio.realm = twilio.realm || "dev"; if(typeof(twilio)=='undefined'){var twilio={};}
if(typeof(twilio.client)=='undefined'){twilio.client={};}
twilio.client.ui={token:null,closable:true,target:'#twilio-client-dialog',startTime:null,tickInterval:null,connection:null,init:function(){var self=this;self.token=$('#twilio-client-capability-token').val();if(self.token==undefined||!self.token.length){return}
Twilio.Device.setup(self.token);Twilio.Device.disconnect(function(){self.hangup();});Twilio.Device.cancel(function(){self.hangup();});Twilio.Device.error(function(){self.hangup();});Twilio.Device.offline(function(){self.hangup();});$(self.target).on('show',function(){self.connect();});$(self.target).on('hide',function(){self.hangup();});$(self.target+' .redial-button').click(function(){self.connect();$(this).hide();$(self.target+' .end-call-button').show();});$(self.target+' .end-call-button').click(function(){self.hangup();});$('body').on('twilio.client.dialpad.number',function(e,number){if(!self.connection){return;}
self.connection.sendDigits(number);});},connect:function(params,message,startTick){if(!params){params={}
var number=$(this.target).data('phone-number');if(number){params['phone_number']=number;}}
message=message||'Time on Call';startTick=typeof(startTick)=='undefined'?true:startTick;this.connection=Twilio.Device.connect(params);this.message(message);if(startTick){this.startTick();}},hangup:function(message,endTick){$(this.target+' .end-call-button').hide();$(this.target+' .redial-button').show();message=message||'Call Completed';endTick=typeof(endTick)=='undefined'?true:endTick;if(this.connection){this.connection.disconnect();this.connection=null;}
this.message(message);if(endTick){this.endTick();}},startTick:function(){this.startTime=new Date();this.tickInterval=setInterval('twilio.client.ui.tick()',1000);this.displayTime();},tick:function(){this.displayTime();},endTick:function(){this.startTime=null;if(this.tickInterval){clearInterval(this.tickInterval);this.tickInterval=null;}},getTicks:function(){var currentTime=new Date();return currentTime.getTime()-this.startTime.getTime();},displayTime:function(){var seconds=Math.floor(this.getTicks()/1000);var minutes=Math.floor(seconds/60);var seconds=seconds%60;if(minutes<10){minutes='0'+minutes;}
if(seconds<10){seconds='0'+seconds;}
$(this.target+' .time').text(minutes+':'+seconds);},message:function(text){$(this.target+' .msg').text(text);}};;$(function(){if(typeof Twilio!=='undefined'){if($('@phone-dial-pad').length){twilio.client.dialpad.init();}
if($('@twilio-client-connect').length){twilio.client.ui.init();}}});;if(typeof(twilio)=='undefined'){var twilio={};}
if(typeof(twilio.client)=='undefined'){twilio.client={};}
twilio.client.dialpad={target:'#phone-dial-pad',init:function(){var self=this;$(this.target+' .number').on('click',function(e){var number=$(this).data('number');if($.isNumeric(number)){number=number.toString();}
$('body').trigger('twilio.client.dialpad.number',[number]);});$(window).keydown(function(event){if(!self.isVisible()){return;}
var button=self.translateKeyCode(event.keyCode,event.shiftKey);if(button){$('#dial-number-'+button).addClass('active');}});$(window).keyup(function(event){if(!self.isVisible()){return;}
var button=self.translateKeyCode(event.keyCode,event.shiftKey);if(button){$('#dial-number-'+button).removeClass('active').trigger('click');}});},isVisible:function(){return $(this.target).is(':visible');},translateKeyCode:function(code,shift){var char=String.fromCharCode(code);if(char=='3'&&shift){return'hash';}
if(char=='8'&&shift){return'asterisk';}
switch(char.toLowerCase()){case'1':return'1';case'2':case'a':case'b':case'c':return'2';case'3':case'd':case'e':case'f':return'3';case'4':case'g':case'h':case'i':return'4';case'5':case'j':case'k':case'l':return'5';case'6':case'm':case'n':case'o':return'6';case'7':case'p':case'q':case'r':case's':return'7';case'8':case't':case'u':case'v':return'8';case'9':case'w':case'x':case'y':case'z':return'9';case'0':return'0';case'*':return'asterisk';case'#':return'hash';}
return null;}};